
\subsection{Design del database}

Il design del database è stato effettuato sulla base delle richieste del cliente.
L'azienda ci ha fornito un file excel contenente tutti i dati che dovevano essere inseriti nel database.

Sulla base di questo file, sono stati creati diversi schemi, ognuno dei quali rappresenta un entità del dominio.

\begin{itemize}
    \item \textbf{User}: contiene i dati degli utenti, ovvero i dipendenti dell'azienda.
    \item \textbf{Credential}: contiene le credenziali degli utenti.
    \item \textbf{Objective}: contiene tutti gli obiettivi che l'azienda si pone.
    \item \textbf{Assigned}: contiene i valori dell'obiettivo, per ogni utente.
    \item \textbf{Default}: contiene i valori di default di ogni obiettivo.
    \item \textbf{Data}: contiene il valore corrente di un utente per un obiettivo.
\end{itemize}

Di seguito vengono mostrati gli schemi del database creati con Mongoose.

\begin{verbatim}
const userSchema = new Schema({
    username: { type: String, required: true, unique: true},
    name: { type: String, required: true, },
    surname: { type: String, required: true },
    position: { type: String, required: true },
    manager: { type: String },
});
\end{verbatim}

Da notare che l'unico campo non required è il manager. Abbiamo scelto di non renderlo obbligatorio in quanto
ci potrebbero essere delle inconsistenze, o anche solo delle complicazioni, a gestire alcune situazioni.
Inoltre, dopo aver parlato con gli stakeholder, è emerso che la gestione del suddetto campo non è fondamentale 
ai fini del progetto.

La chiave primaria di questo schema è il campo \textit{username}, che è unico.

\begin{verbatim}
const credentialsSchema = new Schema({
    username: { type: String, required: true, unique: true },
    password: { type: String, required: true },
    role: { type: String, required: true }
});
\end{verbatim}

TODO

\begin{verbatim}
const objectivesSchema = new Schema({
    name: { type: String, required: true, unique: true },
    type: { type: String, required: true },
})
\end{verbatim}

Questo schema è molto semplice: per ogni obiettivo si salvano nome e tipo. Il nome dell'obiettivo è la 
chiave primaria, ed è unico.

\begin{verbatim}
const assignedObjectives = new Schema({
    user: { type: String, required: true },
    objective: { type: String, required: true },
    baseValue: { type: Number, required: true },
    value100: { type: Number, required: true },
    value150: { type: Number, required: true },
    weight: { type: Number, required: true },
    year: { type: Number, required: true}
})
\end{verbatim}

Questo schema contiene i valori per ogni obiettivo di ogni utente.
La chiave primaria è composta da \textit{user} e \textit{objective}, in quanto un utente per un determinato 
obiettivo può avere solo un valore. La semantica dei vari campi (value100, value150, etc..) deriva dai dati
forniti dall'azienda.

\begin{verbatim}
const defaultsObjectivesSchema = new Schema({
    objective: { type: String, required: true, unique: true },
    defaultBaseValue: { type: Number, required: true },
    default100: { type: Number, required: true },
    default150: { type: Number, required: true },
    defaultWeight: { type: Number, required: true },
})
\end{verbatim}

In questo schema, sono salvati i valori di default per ogni obiettivo. La chiave primaria è il nome dell'obiettivo.
I valori di default sono stati forniti dall'azienda e sono utilizzati in caso non vengano assegnati dei valori 
specifici all'utente.

\begin{verbatim}
const dataSchema = new Schema({
    objective: { type: String, required: true},
    username: { type: String, required: true },
    date: { type: Date, required: true},
    value: { type: Number, required: true },
})
\end{verbatim}

Nel Data schema sono contenuti i valori reali di un utente per un obiettivo in una determinata data.